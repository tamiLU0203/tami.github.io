<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todolist-js</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <div class="wrapper">
        <h1>Todo List</h1>
        <div class="inputField">
            <div class="todoInput task">
                <h2>任務</h2>
                <input id="input" type="text"  placeholder="請輸入你的任務名稱">
            </div>
            <div class="todoInput date">
                <h2>日期</h2>
                <input id="input" type="date"  placeholder="請輸入日期">
            </div>
            <button id="addBtn">Add Task</button>
        </div>
        <ul class="todoList">
            <li>
                <input type="checkbox" id="check1">
                <div class="list">
                    <label for="check0">text</label>
                    <label for="check1">date</label>
                </div>
                <span class="deleteicon trash"><i class="fa fa-trash"></i></span>
                <span class="editicon pencil"><i class="fa fa-pencil"></i></span>
            </li>
        </ul>
        <div class="edit-box disNone">
            <div class="edit">
                <i class="index-edit"></i>
                <div class="fa fa-times-circle" aria-hidden="true"></div>
                <h2>編輯任務</h2>
                <input class="input" type="text"  placeholder="請輸入你的任務名稱">
                <input class="input" type="date"  placeholder="請輸入日期">
                <div class="btnGroup">
                    <button class="deleteBtn">取消</button>
                    <button class="comfirmBtn">確認</button>
                </div>
            </div>
        </div>
        <div class="delete-box disNone">
            <div class="delete disNone">
                <i class="index-delete"></i>
                <div class="fa fa-times-circle" aria-hidden="true"></div>
                <h2>是否要刪除任務</h2>
                <div class="btnGroup">
                    <button class="deleteBtn">取消</button>
                    <button class="comfirmBtn">確認</button>
                </div>
            </div>
        </div>


    </div>
</body>
<Script>
    const inputBox = document.querySelectorAll(".inputField input");     
    const addBtn = document.querySelector(".inputField button");     
    const todoList = document.querySelector(".todoList");     
    const deleteBtn = document.querySelector(".deleteicon");     
    const editBox = document.querySelector(".edit-box");     
    var listArray = [];

    showTasks();
    function newTaskList() {
        let isValue = Array.from(inputBox).every(input => input.value !== "")
        let result = []
        inputBox.forEach(input => {
            if(input.value != "") result.push(input.value)
        })
        return { isValue , result }
    }

    function showTasks(){
        let getLocalStorageData = localStorage.getItem('newTodo');
        if (getLocalStorageData == null) listArray = [];
        else listArray = JSON.parse(getLocalStorageData);
        let newTodoList = '';
        listArray.forEach((element, index) => {
            newTodoList += `
                <li>
                <input type="checkbox" id="check${index}">
                <div class="list">
                    <label for="check${index}">${element[0]}</label>
                    <label for="check${index}">${element[1]}</label>
                </div>
                <span class="editicon trash" onclick="deletedTask(${index})"><i class="fa fa-trash"></i></span>
                <span class="editicon pencil" onclick="openEditTask(${index})"><i class="fa fa-pencil"></i></span>
            </li>
            `;
        });
        todoList.innerHTML = newTodoList;
        inputBox.forEach(input => input.value = "")
    }
    addBtn.onclick = () => {
        let { isValue, result } = newTaskList()
        if ( isValue ){
            let getLocalStorageData = localStorage.getItem('newTodo');
            if (getLocalStorageData == null) listArray =[];
            else listArray = JSON.parse(getLocalStorageData);
            listArray.push(result);
            localStorage.setItem('newTodo', JSON.stringify(listArray));
            showTasks();
        }
    }
    function deletedTask(index){
        let getLocalStorageData = localStorage.getItem('newTodo');
        listArray = JSON.parse(getLocalStorageData);
        listArray.splice(index, 1);
        localStorage.setItem("newTodo", JSON.stringify(listArray));
        showTasks();
    }
    deleteBtn.onclick = () => {
        listArray = [];
        localStorage.setItem("newTodo", JSON.stringify(listArray));
        showTasks();
    }
    function openEditTask(index){
        let getLocalStorageData = localStorage.getItem('newTodo');
        listArray = JSON.parse(getLocalStorageData);
        editValue = listArray[index];
        editBox.querySelector(".index-edit").innerText = index;
        editBox.querySelectorAll(".input").forEach((input, key)=>{
            input.value = listArray[index][key]
        })
        editBox.classList.remove("disNone");
    }
    editBox.querySelector('.comfirmBtn').addEventListener("click", () => {
        let editValue = editBox.querySelectorAll(".input");
        let index = editBox.querySelector(".index-edit").innerText;
        let getLocalStorageData = localStorage.getItem('newTodo');
        let listArray = JSON.parse(getLocalStorageData);
        let newListArray = listArray.map((item, key) => {
            if (key === Number(index))
                return [editValue[0].value, editValue[1].value];
            return item;
        })
        localStorage.setItem("newTodo", JSON.stringify(newListArray));
        showTasks();
        editBox.classList.add("disNone");
    });

</Script>
</html>